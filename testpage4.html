<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en-US"
      lang="en-US">
<head profile="http://www.w3.org/2005/10/profile">
    <title>My Force Directed Graph</title>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"/>
    <meta name="Description" content="This page tries to mix charts with html formatting and layout constructs."/>

    <STYLE type="text/css">
        html, body {
            margin: 0;
            padding: 0;
            overflow: hidden
        }

        .chart {
            background-color: lightslategrey;
        }

        svg {
            font: 10px sans-serif;
            display: block;
        }

        circle {
            /**stroke: 10px solid black;*/
        }
    </STYLE>

    <script type="text/javascript" src="javascripts/d3.v3.min.js"></script>
    <script src="javascripts/jquery-1.12.2.js" type="text/javascript"></script>

    <script type="text/javascript">

        function drawCluster() {
            var width = $(document).width();
            var height = $(document).height();
            var middlePoint = {X: width / 2, Y: height / 2};

            var countries = [];
            var nodesData = [];
            var linksData = [];
            var selectedCountry;

            var radiusCenter = 50;
            var radiusOuter = 20;
            var buffer1 = 5; // buffer between outer nodes
            var buffer2 = 25; // buffer between mid circle and outer circles
            var radius = radiusOuter + radiusCenter + buffer2; // radius of circle on which outer nodes should be drawn

            var svg = d3.select(".chart")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);


            d3.json("data/countries.json", function (error, data) {
                        if (error) throw error;

                        countries = data.countries;

                        //aantal gegeven punten
                        var pointsCount = countries.length - 1;

                        // hoek tussen landen
                        var slice = 2 * Math.PI / pointsCount;

                        //dynamically changes the radius
                        var temp = pointsCount * (buffer1 + radiusOuter * 2);
                        while (radius * Math.PI * 2 < temp) {
                            radius += 20;
                        }

                        //België
                        selectedCountry = {country: countries[0], X: middlePoint.X, Y: middlePoint.Y, R: radiusCenter};

                        // selected country
                        nodesData.push(selectedCountry);

                        var i = 1;
                        countries.slice(1, countries.length).forEach(
                                function (c) {
                                    angle = slice * (i - 1);
                                    X = middlePoint.X + (selectedCountry.country.neighbours.indexOf(c) != -1 ? radius : radius * 2) * Math.cos(angle);
                                    Y = middlePoint.Y + (selectedCountry.country.neighbours.indexOf(c) != -1 ? radius : radius * 2) * Math.sin(angle);

                                    nodesData.push({country: countries[i], X: X, Y: Y, R: radiusOuter});
                                    //Heen
                                    linksData.push({source: 0, target: i, score: 50});

                                    //Terug
                                    linksData.push({source: i, target: 0, score: 25});
                                    i++;
                                });

                        var links = svg.selectAll("link")
                                .data(linksData);


                        var lineFunction = d3.svg.line()
                                .x(function (d) {
                                    return d.x;
                                })
                                .y(function (d) {
                                    return d.y;
                                });


                        links.enter()
                                .append("line")
                                .attr("class", "link")
                                .attr("x1", function (l) {
                                    var sourceNode = nodesData.filter(function (d, i) {
                                        return i == l.source
                                    })[0];
                                    d3.select(this).attr("y1", sourceNode.Y);
                                    return sourceNode.X
                                })
                                .attr("x2", function (l) {
                                    var targetNode = nodesData.filter(function (d, i) {
                                        return i == l.target
                                    })[0];
                                    d3.select(this).attr("y2", targetNode.Y);
                                    return targetNode.X
                                })
                                .attr("stroke", "black");

                        /*
                         .attr("d", function (d) {
                         var dx = d.target.x - d.source.x,
                         dy = d.target.y - d.source.y,
                         dr = Math.sqrt(dx * dx + dy * dy);
                         return "M" +
                         d.source.x + "," +
                         d.source.y + "A" +
                         dr + "," + dr + " 0 0,1 " +
                         d.target.x + "," +
                         d.target.y;
                         });
                         */


                        var nodes = svg.selectAll("node")
                                .data(nodesData);

                        nodes.enter().append('defs')
                                .append('pattern')
                                .attr('id', function (d) {
                                    return (d.country.countryCode + "-icon");
                                })
                                .attr('width', 1)
                                .attr('height', 1)
                                .attr('patternContentUnits', 'objectBoundingBox')
                                .append("image")
                                .attr("xlink:xlink:href", function (d) {
                                    return ("./images/flags/" + d.country.image);
                                })
                                .attr("height", 1)
                                .attr("width", 1)
                                .attr("preserveAspectRatio", "xMinYMin slice");

                        nodes.enter().append("circle")
                                .attr("class", "node")
                                .attr("cx", function (d) {
                                    return d.X
                                })
                                .attr("cy", function (d) {
                                    return d.Y
                                })
                                .attr("r", function (d) {
                                    return d.R
                                })
                                .style("fill", function (d) {
                                    return ("url(#" + d.country.countryCode + "-icon)");
                                });
                    }
            );
        }

    </script>
</head>
<body>
<div class="container" id="container">
    <div class="chart"></div>
</div>
<script type="text/javascript">drawCluster()</script>

</body>

</html>